---
title: "Contact Experiment Data Analysis"
output: html_notebook
---

First Step is to load the necessary package, If you dont have them just install them. For jjstatsplot you need to install it remotely.
Just remove the dash and press enter. Then Press 3 (none package to be updated). 

```{r}
#remotes::install_github("sbalci/jjstatsplot") #Press 3 !!!!! i.e., installing/Updating none package! 
library(jmv)
library(datasets)
library(plyr)
library(readr)
library(dataframes2xls)
library(dplyr)
library(data.table)
library(plyr)
library(ggstatsplot)
library(jjstatsplot)
library(lme4)
library(lmerTest)
```



[//]: # (Reading RAW data) 

For each participant folder in rawdata, load its csv
**make sure there is no empty folder**, i.e we expect a csv file per participant folder

```{r}
directoryIndex <- list.dirs(path = "./rawdata", full.names = TRUE)

# for debugging, let's work by now with only the first case
nrParticipants <- length(directoryIndex[-1])
#nrParticipants <- 1

# let's declare a list of dataframes (a generic list)
participantsRawList <- list()

for (i in 1:nrParticipants)
{
  name <- sprintf("rawdata/%d/%d.csv",i, i)
  #print(name)
  participantsRawList[[i]] <- read.csv(name)
}

```

let's transform distances from meters to centimeters.

```{r}
# for tidyverse
if(!require(dplyr)){install.packages('dplyr')}
library(dplyr)


for (i in 1 :length(participantsRawList))
{
  participantsRawList[[i]] <-  participantsRawList[[i]] %>%
    mutate(MaxInterpenetrationCM = MaxInterpenetration * 100.0) %>%
    mutate(AverageInterpenetrationCM = AverageInterpenetration * 100.0) %>%
    mutate(AverageOffsetFromSurfaceCM = AverageOffsetFromSurface * 100.0)
}
```

Discard first X trials per interpenetration feedback condition and then create a summary
table for each participant. You need to define **nrTrialsPerBlockToRemove**.

```{r}

nrTrialsPerBlockToRemove <- 2
#trialsToRemove <- seq(from = 1, to = nrTrialsPerBlockToRemove)



participantsFilteredDF <- participantsRawList
for (i in 1 :length(participantsRawList))
{
  participantsFilteredDF[[i]] <-  participantsFilteredDF[[i]] %>%
    group_by(Block, InterpenetrationFeedback) %>%
    slice(nrTrialsPerBlockToRemove+1:n())
  # to double check we are discarding the right rows
  #print(participantsFilteredDF[[i]]$Trial)
}

 paok <- bind_rows(participantsFilteredDF, .id = "column_label")

```
  
```{r}  
  # create summary (we are not considering here the shading variable)
  # this time we don't care anymore grouping by "block".
  # we care now only for interpenetration feedback

experimentDF <- data.frame(
  ParticipantID=numeric(),
  InterpenetrationFeedback=character(),
  NrOfAdjustments=numeric(),
  InterpenetrationTime=numeric(),
  TrialTime=numeric(),
  FirstContactTime=numeric(),
  MaxInterpenetrationCM=numeric(),
  AverageInterpenetrationCM=numeric(),
  AverageOffsetFromSurfaceCM=numeric(),
  ReleaseReactionTime=numeric(),
  stringsAsFactors=FALSE)

 for (i in 1 :length(participantsRawList))
{
   participantSummaryEntry <- participantsFilteredDF[[i]] %>%
    group_by(InterpenetrationFeedback) %>%
    summarise_at(
      vars(
        NrOfAdjustments,# maybe nr of adjustments should be treated differently
        InterpenetrationTime,
        TrialTime,
        FirstContactTime,
        MaxInterpenetrationCM,
        AverageInterpenetrationCM,
        AverageOffsetFromSurfaceCM,
        ReleaseReactionTime),
      funs(mean(., na.rm=TRUE))
      
    )
   

  
  # add 'participant id' column for reference
  participantSummaryEntry <- participantSummaryEntry %>%
    mutate(ParticipantID = i)
  
  experimentDF <- rbind(experimentDF, participantSummaryEntry)
}

```

Let's show distribution of dependent variables by interpenetration feedback

```{r}

# for ggplot
if(!require(ggplot2)){install.packages('ggplot2')}
library(ggplot2)

experimentElectrotactile <- experimentDF %>%
                              filter(InterpenetrationFeedback == "Electrotactile")

experimentVisual <- experimentDF %>%
                              filter(InterpenetrationFeedback == "Visual")

experimentBoth <- experimentDF %>%
                              filter(InterpenetrationFeedback == "Both")

experimentNoFeedback <- experimentDF %>%
                              filter(InterpenetrationFeedback == "NoFeedback")

binSize = 0.25# cm

ggplot(data=experimentElectrotactile, aes(AverageInterpenetrationCM)) + 
  geom_histogram(binwidth = binSize, col="white", size=.5)

ggplot(data=experimentVisual, aes(AverageInterpenetrationCM)) + 
  geom_histogram(binwidth = binSize, col="white", size=.5)

ggplot(data=experimentBoth, aes(AverageInterpenetrationCM)) + 
  geom_histogram(binwidth = binSize, col="white", size=.5)

ggplot(data=experimentNoFeedback, aes(AverageInterpenetrationCM)) + 
  geom_histogram(binwidth = binSize, col="white", size=.5)

```

