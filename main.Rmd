---
title: "Contact Experiment Data Analysis"
output: html_notebook
---

First Step is to load the necessary package, If you dont have them just install them. For jjstatsplot you need to install it remotely.
Just remove the dash and press enter. Then Press 3 (none package to be updated). 
?group_by()

```{r}
#remotes::install_github("sbalci/jjstatsplot") #Press 3 !!!!! i.e., installing/Updating none package! 
library(jmv)
library(datasets)
library(plyr)
library(readr)
library(dataframes2xls)
library(dplyr)
library(data.table)
library(plyr)
library(ggstatsplot)
library(jjstatsplot)
library(lme4)
library(lmerTest)
library(ggplot2)
library(rstatix)
library(coin)
library(ARTool)
library(ggpubr)
library(tidyverse)
```



Import and merge all the csv files (x.csv where x = ID) of the folder. Note, that the ID is has already been added as column 
```{r}
data <- list.files(path = "C:/Users/pkourtes/Desktop/ContactExperiment/Results/Participants/MergingFolder",     # Identify all csv files in folder
                       pattern = "*.csv", full.names = TRUE) %>% 
  lapply(read_csv) %>%                                            # Store all files in list
  bind_rows                                                       # Combine data sets into one data set 
data 
```


Discard first X trials per interpenetration feedback condition and then create a summary
table for each participant. You need to define **nrTrialsPerBlockToRemove**.
```{r}

nrTrialsPerBlockToRemove <- 1
#trialsToRemove <- seq(from = 1, to = nrTrialsPerBlockToRemove)

  data <-  data %>%
    group_by(ID, Block, InterpenetrationFeedback, FullyShaded) %>% # I have added here the fully shaded 
    slice(nrTrialsPerBlockToRemove+1:n())
  # to double check we are discarding the right rows
  #print(data[[i]]$Trial)

 # This df will be used to create the subsets for 1st part and 2nd part of the experiment. 

```
  

Discard unnecessary variables 

```{r}
NewData <- data
NewData <- select(NewData,-"Block", -"Trial", -"TrialInBlock", -"NrOfAdjustments" ,
                  -"Completed" , -"Attempts" , -"Skipped")
names(NewData)
```

Let's average the data. This will create 8 (Eight) averaged rows per participant. 
The logic is 4 Types of interpenetration feedback * 2 Shade conditions (4 x 2 = 8)   
```{r}  
Averaged_Data <- aggregate(. ~ ID + Age + Gender + InterpenetrationFeedback + FullyShaded, NewData, mean)


df <- Averaged_Data # A more Convenient name for our dataset

```


Convert from meters to cm  
```{r}
df$MaxInterpenetration <- df$MaxInterpenetration * 100
df$AverageInterpenetration <- df$AverageInterpenetration * 100
df$AverageOffsetFromSurface <- df$AverageOffsetFromSurface * 100

```


Check the distribution of the main dependent variables using histograms
```{r}
hist(df$MaxInterpenetration)
hist(df$AverageInterpenetration)
```
Based on the histograms, the distribution is heavily positively skewed, which is not good, probably we ve violated the normality assumption
Let's check the normality assumption (i.e., whether we have normal distribution or not)
```{r}
shapiro_test(df$MaxInterpenetration)
shapiro_test(df$AverageInterpenetration)
ggqqplot(df$MaxInterpenetration)
ggqqplot(df$AverageInterpenetration)

#Let's check the assumption for each interpenetration feedback and shade condition
df %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(MaxInterpenetration) #It is violated!

df %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(AverageInterpenetration)  #It is violated!

```

OK, we have significant results which means that we have violated the normality assumption (i.e, abnormal distribution).
Let's try to identify the outliers
```{r}
# One df for outliers (1.5 coeff), one for extremes (3 coeff)
df2 <- df
###############################


df_outliers <- identify_outliers(df, variable = "MaxInterpenetration") #we have several ones
df_outliers2  <- identify_outliers(df, variable = "MaxInterpenetration")


df$Outlier <- is_outlier(df$MaxInterpenetration) #Let's make another variable indicating whether the row is an outlier or not
df$Outlier2 <- is_outlier(df$AverageInterpenetration)

df$Extreme1 <- is_extreme(df$MaxInterpenetration)

df$Extreme2 <- is_extreme(df$AverageInterpenetration)


####### Only extreme values for df2

df_Extremes <- identify_outliers(df, variable = "MaxInterpenetration", coef = 3) #we have several ones
df_Extremes2  <- identify_outliers(df, variable = "MaxInterpenetration", coef = 3)

df2$Extreme1 <- is_extreme(df2$MaxInterpenetration)

df2$Extreme2 <- is_extreme(df2$AverageInterpenetration)

```

Let's try to solve it by omitting the outliers 
```{r}
df$Outlier[df$Outlier == TRUE]  <- NA
df$Outlier2[df$Outlier2 == TRUE]  <- NA

df_clean <- na.omit(df) #We omit the rows which have NA values !!! and we create a new dataset without outliers.

#we check again the histograms, qqplots, and normality assumption
hist(df_clean$MaxInterpenetration) 
hist(df_clean$AverageInterpenetration) #better than before but stil skewed
shapiro_test(df_clean$MaxInterpenetration)
shapiro_test(df_clean$AverageInterpenetration) # violated!
ggqqplot(df_clean$MaxInterpenetration)
ggqqplot(df_clean$AverageInterpenetration) #qqplots are good.

df_clean %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(MaxInterpenetration) #Still some violate the assumption

df_clean %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(AverageInterpenetration) #Still some violate the assumption
 


################# Let's do the same just only for the extreme values

df2$Extreme1[df2$Extreme1 == TRUE]  <- NA
df2$Extreme2[df2$Extreme2 == TRUE]  <- NA

df2_clean <- na.omit(df2) #We omit the rows which have NA values !!! and we create a new dataset without outliers.


df2_clean %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(MaxInterpenetration) #Still some violate the assumption



df2_clean %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(AverageInterpenetration) #Still some violate the assumption
 
```

OK the distribution is better now but again it violates the normality assumption

Let's try to correct the problem with the Normality of the Variance. 
The reason, as we can see above by checking the histograms, is that the distribution is very positively skewed.
We dont want any type of an intense skew (Though, always there is somewhat of skewness in the data). 
```{r}
#A common thing to resolve the positive skewness is to covert the IVs into logarithms 

df_clean$MaxInterpenetration <- log10(df_clean$MaxInterpenetration)

df_clean$AverageInterpenetration <- log10(df_clean$AverageInterpenetration)

#we check again the histograms, qqplots, and normality assumption
hist(df_clean$MaxInterpenetration) 
hist(df_clean$AverageInterpenetration) # WoW, they seems like normally distributed
shapiro_test(df_clean$MaxInterpenetration) #WOW! That's it Normal Distribution
shapiro_test(df_clean$AverageInterpenetration) # YEAH! Normal Distribution ladies and gentlemen :) 
ggqqplot(df_clean$MaxInterpenetration)
ggqqplot(df_clean$AverageInterpenetration) #qqplots are still good.


df_clean %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(MaxInterpenetration)

df_clean %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(AverageInterpenetration)
# No Violations . We are ready for Two Way Repeated Measures ANOVA



####################### The same for the df where we excluded only the extreme values (i.e., coeff = or > 3)

df2_clean$MaxInterpenetration <- log10(df2_clean$MaxInterpenetration)

df2_clean$AverageInterpenetration <- log10(df2_clean$AverageInterpenetration)

#we check again the histograms, qqplots, and normality assumption
hist(df2_clean$MaxInterpenetration) 
hist(df2_clean$AverageInterpenetration) # WoW, they seems like normally distributed
shapiro_test(df2_clean$MaxInterpenetration) #WOW! That's it Normal Distribution
shapiro_test(df2_clean$AverageInterpenetration) # YEAH! Normal Distribution ladies and gentlemen :) 
ggqqplot(df2_clean$MaxInterpenetration)
ggqqplot(df2_clean$AverageInterpenetration) #qqplots are still good.


df2_clean %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(MaxInterpenetration)

df2_clean %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(AverageInterpenetration)
# No Violations . We are ready for Two Way Repeated Measures ANOVA


# However 
#It seems that many of the outliers (> 1.5 coeff) were also extremes (> 3 coeff) 
# While all the outliers and the extremes derive from the IDs : 9 , 17 , and 20

```


Another Solution for solving the normality violation
```{r}
#Another more extreme solution for positive skewness
# For extreme cases, we can also try also to divide 1 by our values (Re assign )

# df_clean$MaxInterpenetration <- 1/df_clean$MaxInterpenetration

# df_clean$AverageInterpenetration <- 1/df_clean$AverageInterpenetration

```



let's check the plots of the means to see what happens in our cleaned data.

```{r}
# We are going to prefer the one where we excluded only the extreme values
# so df2_clean will be the df that we will use

# The first two blocks comparing IVs effect on DV
p1 <- ggstatsplot::ggbetweenstats(
  data = df2_clean,
  x = "InterpenetrationFeedback", #Indepedent Variable
  y = "MaxInterpenetration", # Depedent Variable
  grouping.var = "FullyShaded", # 2nd IV 
  type = "p", # parametric test i.e., p values
  pairwise.comparisons = TRUE, #compute pairwise comparisons
  pairwise.display = "significant", 
  p.adjust.method = "bonferroni", # correction of p-value
  effsize.type = "unbiased", # Calculates the Hedge's g for t tests and the partial Omega for ANOVA
  xlab = "Type of Feedback", #label of X axis
  ylab = "Maximum Interpenetration", #label of y axis
  var.equal = TRUE, #Assuming Equal variances
  mean.ci = TRUE, #display the confidence interval of the mean
  notch = TRUE, #Compare the medians i.e., IQR with 95% confidence interval
  paired = TRUE #indicating that we have a within subject design
  ) 

p2 <- ggstatsplot::ggbetweenstats(
  data = df2_clean,
  x = "InterpenetrationFeedback",
  y = "AverageInterpenetration",
  grouping.var = "FullyShaded",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Type of Feedback",
  ylab = "Average Interpenetration",
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
)


# Replicating the above but this time we look on the effect of the type of feedback on the DVs when the shaded is true and when it is false.
p3 <- ggstatsplot::grouped_ggbetweenstats(
  data = df2_clean,
  x = "InterpenetrationFeedback",
  y = "MaxInterpenetration",
  grouping.var = "FullyShaded",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Type of Feedback",
  ylab = "Maximum Interpenetration",
  sub.text = "Explicit Visual Representation" ,
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
  ) 

p4 <- ggstatsplot::grouped_ggbetweenstats(
  data = df2_clean,
  x = "InterpenetrationFeedback",
  y = "AverageInterpenetration",
  grouping.var = "FullyShaded",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Type of Feedback",
  ylab = "Average Interpenetration",
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
) 

# Lets check the effect of shaded condition on DVs
p5 <- ggstatsplot:: ggbetweenstats(
  data = df2_clean,
  x = "FullyShaded",
  y = "MaxInterpenetration",
  grouping.var = "InterpenetrationFeedback",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Target's Visual Representation",
  ylab = "Maximum Interpenetration",
  sub.text = "Explicit Visual Representation" ,
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
  ) 

p6 <- ggstatsplot::ggbetweenstats(
  data = df2_clean,
  x = "FullyShaded",
  y = "AverageInterpenetration",
  grouping.var = "InterpenetrationFeedback",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Target's Visual Representation",
  ylab = "Average Interpenetration",
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
) 

p7 <- ggstatsplot::grouped_ggbetweenstats(
  data = df2_clean,
  x = "FullyShaded",
  y = "MaxInterpenetration",
  grouping.var = "InterpenetrationFeedback",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Target's Visual Representation",
  ylab = "Maximum Interpenetration",
  sub.text = "Explicit Visual Representation" ,
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
  ) 

p8 <- ggstatsplot::grouped_ggbetweenstats(
  data = df2_clean,
  x = "FullyShaded",
  y = "AverageInterpenetration",
  grouping.var = "InterpenetrationFeedback",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Target's Visual Representation",
  ylab = "Average Interpenetration",
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
) 
p1

p2

p3 

p4

p5 

p6

p7

p8

plist <- list(p1,p2)
plist2 <- list(p3,p4)
plist3 <- list(p5,p6)
plist4 <- list(p7,p8)

combine_plots(
  plotlist = plist, 
  title.text = "Interpenetration Box-Violin Plots",
  caption.text = "Note: Interpenetration distance is displayed in cm.",
  title.color = "black",
  caption.color = "black")

combine_plots(
  plotlist = plist2, 
  title.text = "Interpenetration Box-Violin Plots",
  caption.text = "Note: Interpenetration distance is displayed in cm.",
  title.color = "black",
  caption.color = "black")

combine_plots(
  plotlist = plist3, 
  title.text = "Interpenetration Box-Violin Plots",
  caption.text = "Note: Interpenetration distance is displayed in cm.",
  title.color = "black",
  caption.color = "black")

combine_plots(
  plotlist = plist4, 
  title.text = "Interpenetration Box-Violin Plots",
  caption.text = "Note: Interpenetration distance is displayed in cm.",
  title.color = "black",
  caption.color = "black")

```
So based on the above plots we can see that
###############################################
For the maximum interpenetration (plot 1): 

the both, electrotactile, and visual types of feedback are significantly better than no feedback. 
while there NOT significant differences amongst them. 
Another important info is the effect size based on partial omega squared which is 0.20 i.e., the effect size is large

Reference for interpreting Omega Squared
Small effect: ω2 = 0.01;
Medium effect: ω2 = 0.06;
Large effect: ω2 = 0.14.

Also, the logarith of Bayes Factor [ Log(BF01) ] for testing hypotheses is -14.86 
which means that there are extremely strong evidence in favor of H1 alternative hypothesis. 


##############
For averaged interpenentration (plot2):

Similar to the results for the maximum interpenetration


#############################################################################################################
For the relationship between the shade condition and the type of feedback on 

##########
maximum interpenetration (plot3) & averaged interpenetration (plot4):

We can see that the results are similar to the plot1 when the shaded condition is false (i.e., when there is not an explicit visual representation of the target object).

However, when the visual representation of the object is explicit (i.e., shaded = TRUE) then the effect of electrotactile feedback is substantially alleviated, 
which results to a non-significant difference between electrotactile and no-feedback conditions. In contrast, the visual and both conditions are still significantly different from the no-feedback condition. However, we can see that the range of the confidence intervals of the both condition is being stretched when the target is fully shaded (an explicit visual representation). 
In contrast, the range of the confidence intervals of visual condition remains intact or slightly decreases when the target's visual representation is explicit. 

Hence, we can theorize that an implicit visual representation of the target (i.e., non-fully shaded) increases the importance of the electrotactile feedback on the performance aspects. This also postulates that when the visual information is insufficient or ambiguous, then the electrotactile feedback complements the sensory information which facilitates visuospatial perception.


####################################
For the shaded condition alone, we can see that it doesn't have an effect on performance (plot 5 & 6) regardless of the type of feedback (plot 7 & 8) 



########################## To Move on ###################################
So, we saw that there is indeed an effect of IV levels (i.e., type of the interpenetration feedback) on the DVs, 
as well as that there is an interrelationship between the levels of the interpenetration feedback and the levels of the shaded condition., especially regarding electrotactile feedback.   

```{r}

#res.aov <- anova_test(
#  data = df2_clean, dv = MaxInterpenetration, wid = ID,
#  within = c(InterpenetrationFeedback, FullyShaded)
#  )
# get_anova_table(res.aov)

#RM <- lmer(MaxInterpenetration ~ InterpenetrationFeedback + FullyShaded + InterpenetrationFeedback*FullyShaded + (1|ID), data = df2_clean, #family = )
#anova(RM)
#summary(RM)
```
 If you run the above then you will see that we get the errors because we don not have ballanced data (i.e., unballanced data)
 
 
 Possible solutions: 
 
 1) Using the ezMixed function from the ez package, which wraps lmer and produces likelihood ratios (a superior metric of evidence)
 
 2) Deleting the IDs which produced the extreme values. However, we will reduce the sample size to N = 21.
 Also, the observations will be 21 (the participants) * 8 Conditions (i.e., 4 types of feedback * 2 Shaded conditions) = 168 observations
 
 3) To try and catch the extreme values before averaging the data! By doing that, we may be able to keep the N = 24. 
 Thanks Ferran :)
 
 
 
So, we will start from solution 3, because it is the best case scenario
```{r}

data$Extreme1 <- is_extreme(data$MaxInterpenetration)

data$Extreme2 <- is_extreme(data$AverageInterpenetration)

data$Extreme1[data$Extreme1 == TRUE]  <- NA
data$Extreme2[data$Extreme2 == TRUE]  <- NA

data_clean <- na.omit(data)

newDF <- select(data_clean, -"Trial", -"TrialInBlock", -"NrOfAdjustments" ,
                  -"Completed" , -"Attempts" , -"Skipped", -"Extreme1", -"Extreme2")

AVnewDF <- aggregate(. ~ ID + Age + Gender + InterpenetrationFeedback + FullyShaded, newDF, mean)

AVnewDF$MaxInterpenetration <- AVnewDF$MaxInterpenetration * 100
AVnewDF$MaxInterpenetration <- AVnewDF$MaxInterpenetration * 100
AVnewDF$MaxInterpenetration <- AVnewDF$MaxInterpenetration * 100

hist(AVnewDF$MaxInterpenetration) 
hist(AVnewDF$AverageInterpenetration) 
ggqqplot(AVnewDF$MaxInterpenetration)
ggqqplot(AVnewDF$AverageInterpenetration)
shapiro_test(AVnewDF$MaxInterpenetration)
shapiro_test(AVnewDF$AverageInterpenetration) 

AVnewDF %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(MaxInterpenetration)

AVnewDF %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(AverageInterpenetration)

# We still have a problem with distribution


#Try by converting the DVs into logarithms again 
AVnewDF$MaxInterpenetration <- log10(AVnewDF$MaxInterpenetration)

AVnewDF$AverageInterpenetration <- log10(AVnewDF$AverageInterpenetration)


hist(AVnewDF$MaxInterpenetration) 
hist(AVnewDF$AverageInterpenetration) 
ggqqplot(AVnewDF$MaxInterpenetration)
ggqqplot(AVnewDF$AverageInterpenetration)
shapiro_test(AVnewDF$MaxInterpenetration)
shapiro_test(AVnewDF$AverageInterpenetration) 

AVnewDF %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(MaxInterpenetration)

AVnewDF %>%
  group_by(InterpenetrationFeedback, FullyShaded) %>%
  shapiro_test(AverageInterpenetration)
############### PERFECT WE ARE GOOD TO GO !!!!!!!!!!!!!!!!!!!!!
```



Lets do the box-violin plots again
```{r}

p1 <- ggstatsplot::ggbetweenstats(
  data = AVnewDF,
  x = "InterpenetrationFeedback", #Indepedent Variable
  y = "MaxInterpenetration", # Depedent Variable
  grouping.var = "FullyShaded", # 2nd IV 
  type = "p", # parametric test i.e., p values
  pairwise.comparisons = TRUE, #compute pairwise comparisons
  pairwise.display = "significant", 
  p.adjust.method = "bonferroni", # correction of p-value
  effsize.type = "unbiased", # Calculates the Hedge's g for t tests and the partial Omega for ANOVA
  xlab = "Type of Feedback", #label of X axis
  ylab = "Maximum Interpenetration", #label of y axis
  var.equal = TRUE, #Assuming Equal variances
  mean.ci = TRUE, #display the confidence interval of the mean
  notch = TRUE, #Compare the medians i.e., IQR with 95% confidence interval
  paired = TRUE #indicating that we have a within subject design
  ) 

p2 <- ggstatsplot::ggbetweenstats(
  data = AVnewDF,
  x = "InterpenetrationFeedback",
  y = "AverageInterpenetration",
  grouping.var = "FullyShaded",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Type of Feedback",
  ylab = "Average Interpenetration",
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
)


# Replicating the above but this time we look on the effect of the type of feedback on the DVs when the shaded is true and when it is false.
p3 <- ggstatsplot::grouped_ggbetweenstats(
  data = AVnewDF,
  x = "InterpenetrationFeedback",
  y = "MaxInterpenetration",
  grouping.var = "FullyShaded",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Type of Feedback",
  ylab = "Maximum Interpenetration",
  sub.text = "Explicit Visual Representation" ,
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
  ) 

p4 <- ggstatsplot::grouped_ggbetweenstats(
  data = AVnewDF,
  x = "InterpenetrationFeedback",
  y = "AverageInterpenetration",
  grouping.var = "FullyShaded",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Type of Feedback",
  ylab = "Average Interpenetration",
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
) 

# Lets check the effect of shaded condition on DVs
p5 <- ggstatsplot:: ggbetweenstats(
  data = AVnewDF,
  x = "FullyShaded",
  y = "MaxInterpenetration",
  grouping.var = "InterpenetrationFeedback",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Target's Visual Representation",
  ylab = "Maximum Interpenetration",
  sub.text = "Explicit Visual Representation" ,
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
  ) 

p6 <- ggstatsplot::ggbetweenstats(
  data = AVnewDF,
  x = "FullyShaded",
  y = "AverageInterpenetration",
  grouping.var = "InterpenetrationFeedback",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Target's Visual Representation",
  ylab = "Average Interpenetration",
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
) 

p7 <- ggstatsplot::grouped_ggbetweenstats(
  data = AVnewDF,
  x = "FullyShaded",
  y = "MaxInterpenetration",
  grouping.var = "InterpenetrationFeedback",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Target's Visual Representation",
  ylab = "Maximum Interpenetration",
  sub.text = "Explicit Visual Representation" ,
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
  ) 

p8 <- ggstatsplot::grouped_ggbetweenstats(
  data = AVnewDF,
  x = "FullyShaded",
  y = "AverageInterpenetration",
  grouping.var = "InterpenetrationFeedback",
  type = "p",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  p.adjust.method = "bonferroni",
  effsize.type = "unbiased",
  xlab = "Target's Visual Representation",
  ylab = "Average Interpenetration",
  var.equal = TRUE,
  mean.ci = TRUE,
  notch = TRUE,
  paired = TRUE
) 
p1

p2

p3 

p4

p5 

p6

p7

p8

plist <- list(p1,p2)
plist2 <- list(p3,p4)
plist3 <- list(p5,p6)
plist4 <- list(p7,p8)

combine_plots(
  plotlist = plist, 
  title.text = "Interpenetration Box-Violin Plots",
  caption.text = "Note: Interpenetration distance is displayed in cm.",
  title.color = "black",
  caption.color = "black")

combine_plots(
  plotlist = plist2, 
  title.text = "Interpenetration Box-Violin Plots",
  caption.text = "Note: Interpenetration distance is displayed in cm.",
  title.color = "black",
  caption.color = "black")

combine_plots(
  plotlist = plist3, 
  title.text = "Interpenetration Box-Violin Plots",
  caption.text = "Note: Interpenetration distance is displayed in cm.",
  title.color = "black",
  caption.color = "black")

combine_plots(
  plotlist = plist4, 
  title.text = "Interpenetration Box-Violin Plots",
  caption.text = "Note: Interpenetration distance is displayed in cm.",
  title.color = "black",
  caption.color = "black")

```

The bad news are that now we do not have an effect between electrotactile and No Feedback conditions

Also, there is a significant difference between Both and Electrotactile Feedback. 

The rest remain as we interpreted above for the plots using the df_clean2 


Let's check the Two Way Repeated Measures ANOVA now
```{r}
"res.aov <- anova_test(
  data = AVnewDF, dv = MaxInterpenetration, wid = ID,
  within = c(InterpenetrationFeedback, FullyShaded)
  )
 get_anova_table(res.aov)

RM <- lmer(MaxInterpenetration ~  InterpenetrationFeedback*FullyShaded + (1|ID), data = AVnewDF)
anova(RM)
summary(RM)
"


```



```{r}

```


```{r}

#res.aov <- anova_test(
#  data = df2_clean, dv = MaxInterpenetration, wid = ID,
#  within = c(InterpenetrationFeedback, FullyShaded)
#  )
# get_anova_table(res.aov)

#RM <- lmer(MaxInterpenetration ~ InterpenetrationFeedback + FullyShaded + InterpenetrationFeedback*FullyShaded + (1|ID), data = df2_clean, #family = )
#anova(RM)
#summary(RM)

```


Now let's split our dataframe into two subtests (1st part and 2nd part of the experiment) to inspect whether there is
an effect of familirisation with electrotactile feedback, as well as a learning effect
```{r}
Data_1st <- subset(newDF, newDF$Block < 4)

Data_2nd <- subset(newDF, newDF$Block > 3)

Data_1st <- select(Data_1st, "ID", "Age", "Gender", "InterpenetrationFeedback", "MaxInterpenetration", "AverageInterpenetration")
Data_2nd <- select(Data_2nd, "ID", "Age", "Gender", "InterpenetrationFeedback", "MaxInterpenetration", "AverageInterpenetration")

Data_1st <- aggregate(. ~ ID + Age + Gender + InterpenetrationFeedback + FullyShaded, Data_1st, mean)

Data_2nd <- aggregate(. ~ ID + Age + Gender + InterpenetrationFeedback + FullyShaded, Data_2nd, mean)
```




```{r}

```


```{r}

```



```{r}

```



